<div class="container-fluid">
  <h2>Pedidos</h2>

  <button (click)="toggleForm()">
    <i class="fa-solid fa-plus"></i> Registrar Pedido
  </button>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Cliente</th>
        <th>Producto</th>
        <th>Total</th>
        <th>Estatus</th>   
        <th>Fecha de Creacion</th>
        <th>Opciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pedido of pedidos; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ obtenerNombreCliente(pedido.idCliente) }}</td>
        <td>{{ obtenerNombresProductos(pedido.idProducto) }}</td>
        <td>{{ pedido.total | currency }}</td>
        <td>
          {{
            pedido.idEstatus === 1 ? 'Pendiente' :
            pedido.idEstatus === 2 ? 'Enviado' :
            pedido.idEstatus === 3 ? 'Entregado' :
            pedido.idEstatus === 4 ? 'Cancelado' : 'Desconocido'
          }}
        </td>
        <td>{{pedido.fechaCreacion}}</td>
        <td>
          <button (click)="editPedido(pedido)">
            <i class="fa fa-edit"></i> Editar
          </button>
          <button (click)="eliminarPedido(pedido)" [disabled]="eliminandoId === pedido.id">
            <ng-container *ngIf="eliminandoId !== pedido.id">
              <i class="fa fa-trash"></i> Eliminar
            </ng-container>
            <ng-container *ngIf="eliminandoId === pedido.id">
              <span>Eliminando...</span>
            </ng-container>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- FORMULARIO -->
  <form [formGroup]="pedidoForm" (ngSubmit)="onSubmit()" [ngClass]="{'show': showForm}" class="form-container">
  
    <h5>{{ textoModal }}</h5>
  
    <!-- Selector de Cliente -->
    <label for="idCliente">Cliente</label>
    <select id="idCliente" formControlName="idCliente">
      <option *ngFor="let cliente of clientes" [value]="cliente.id">
        {{ cliente.nombre }}
      </option>
    </select>
  
    <!-- Lista de Productos -->
    <div formArrayName="productos">
      <div *ngFor="let producto of productosForm.controls; let i = index" [formGroupName]="i">
        
        <label for="idProducto-{{ i }}">Producto</label>
        <select id="idProducto-{{ i }}" formControlName="idProducto">
          <option *ngFor="let producto of productos" [value]="producto.id">
            {{ producto.nombre }}
          </option>
        </select>
  
        <label for="cantidad-{{ i }}">Cantidad</label>
        <input id="cantidad-{{ i }}" formControlName="cantidad" type="number" min="1" />
  
        <button type="button" (click)="removeProducto(i)">
          <i class="fa fa-trash"></i> Eliminar Producto
        </button>
      </div>
    </div>
  
    <button type="button" (click)="addProducto()">
      <i class="fa fa-plus"></i> Agregar Producto
    </button>
  
    <!-- Botones de acciÃ³n -->
    <div class="form-actions">
      <button type="button" (click)="toggleForm()">Cancelar</button>
      <button type="submit" [disabled]="guardando">
        <span *ngIf="guardando">Guardando...</span>
        <span *ngIf="!guardando">Guardar</span>
      </button>
    </div>
  </form>
  
</div>
